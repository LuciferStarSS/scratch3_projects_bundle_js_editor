/* 1210 */\n (function(module, exports, __webpack_require__) {\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\nvar log = __webpack_require__(308);\nvar BuiltinHelper = __webpack_require__(1211);\nvar WebHelper = __webpack_require__(1216);\nvar _Asset = __webpack_require__(309);\nvar _AssetType = __webpack_require__(483);\nvar _DataFormat = __webpack_require__(310);\nvar ScratchStorage = function () {\n  function ScratchStorage() {\n    _classCallCheck(this, ScratchStorage);\n    this.defaultAssetId = {};\n    this.builtinHelper = new BuiltinHelper(this);\n    this.webHelper = new WebHelper(this);\n    this.builtinHelper.registerDefaultAssets(this);\n    this._helpers = [{\n      helper: this.builtinHelper,\n      priority: 100\n    }, {\n      helper: this.webHelper,\n      priority: -100\n    }];\n  }\n \n  _createClass(ScratchStorage, [{\n    key: \"addHelper\",\n   \n    value: function addHelper(helper) {\n      var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      this._helpers.push({\n        helper: helper,\n        priority: priority\n      });\n      this._helpers.sort(function (a, b) {\n        return b.priority - a.priority;\n      });\n    }\n   \n  }, {\n    key: \"get\",\n    value: function get(assetId) {\n      return this.builtinHelper.get(assetId);\n    }\n   \n  }, {\n    key: \"cache\",\n    value: function cache(assetType, dataFormat, data, id) {\n      log.warn('Deprecation: Storage.cache is deprecated. Use Storage.createAsset, and store assets externally.');\n      return this.builtinHelper._store(assetType, dataFormat, data, id);\n    }\n   \n  }, {\n    key: \"createAsset\",\n    value: function createAsset(assetType, dataFormat, data, id, generateId) {\n      if (!dataFormat) throw new Error('Tried to create asset without a dataFormat');\n      return new _Asset(assetType, id, dataFormat, data, generateId);\n    }\n   \n  }, {\n    key: \"addWebStore\",\n    value: function addWebStore(types, getFunction, createFunction, updateFunction) {\n      this.webHelper.addStore(types, getFunction, createFunction, updateFunction);\n    }\n   \n  }, {\n    key: \"addWebSource\",\n    value: function addWebSource(types, urlFunction) {\n      log.warn('Deprecation: Storage.addWebSource has been replaced by addWebStore.');\n      this.addWebStore(types, urlFunction);\n    }\n   \n  }, {\n    key: \"getDefaultAssetId\",\n    value: function getDefaultAssetId(type) {\n      if (this.defaultAssetId.hasOwnProperty(type.name)) {\n        return this.defaultAssetId[type.name];\n      }\n    }\n   \n  }, {\n    key: \"setDefaultAssetId\",\n    value: function setDefaultAssetId(type, id) {\n      this.defaultAssetId[type.name] = id;\n    }\n   \n  }, {\n    key: \"load\",\n    value: function load(assetType, assetId, dataFormat) {\n     \n      var helpers = this._helpers.map(function (x) {\n        return x.helper;\n      });\n      var errors = [];\n      dataFormat = dataFormat || assetType.runtimeFormat;\n      var helperIndex = 0;\n      var helper;\n      var tryNextHelper = function tryNextHelper(err) {\n        if (err) {\n          errors.push(err);\n        }\n        helper = helpers[helperIndex++];\n        if (helper) {\n          var loading = helper.load(assetType, assetId, dataFormat);\n          if (loading === null) {\n            return tryNextHelper();\n          } \n          return loading \n          .catch(tryNextHelper);\n        } else if (errors.length > 0) {\n          \n          \n          return Promise.reject(errors);\n        } \n        return Promise.resolve(null);\n      };\n      return tryNextHelper();\n    }\n   \n  }, {\n    key: \"store\",\n    value: function store(assetType, dataFormat, data, assetId) {\n      var _this = this;\n      dataFormat = dataFormat || assetType.runtimeFormat;\n      return new Promise(function (resolve, reject) {\n        return _this.webHelper.store(assetType, dataFormat, data, assetId).then(function (body) {\n          _this.builtinHelper._store(assetType, dataFormat, data, body.id);\n          return resolve(body);\n        }).catch(function (error) {\n          return reject(error);\n        });\n      });\n    }\n  }, {\n    key: \"Asset\",\n    get: function get() {\n      return _Asset;\n    }\n   \n  }, {\n    key: \"AssetType\",\n    get: function get() {\n      return _AssetType;\n    }\n   \n  }, {\n    key: \"DataFormat\",\n    get: function get() {\n      return _DataFormat;\n    }\n   \n  }], [{\n    key: \"Asset\",\n    get: function get() {\n      return _Asset;\n    }\n   \n  }, {\n    key: \"AssetType\",\n    get: function get() {\n      return _AssetType;\n    }\n  }]);\n  return ScratchStorage;\n}();\nmodule.exports = ScratchStorage;\n })