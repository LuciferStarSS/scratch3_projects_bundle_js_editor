/* 1493 */\n (function(module, exports, __webpack_require__) {\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\nvar formatMessage = __webpack_require__(71);\nvar nets = __webpack_require__(223);\nvar ArgumentType = __webpack_require__(63);\nvar BlockType = __webpack_require__(45);\nvar Cast = __webpack_require__(48);\nvar MathUtil = __webpack_require__(62);\nvar Clone = __webpack_require__(113);\nvar log = __webpack_require__(39);\nvar MonitorRecord = __webpack_require__(295);\n/**\n * Icon svg to be displayed in the blocks category menu, encoded as a data URI.\n * @type {string}\n */\n// eslint-disable-next-line max-len\nvar menuIconURI = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8IS0tIENyZWF0ZWQgd2l0aCBNZXRob2QgRHJhdyAtIGh0dHA6Ly9naXRodWIuY29tL2R1b3BpeGVsL01ldGhvZC1EcmF3LyAtLT4KCiA8Zz4KICA8dGl0bGU+YmFja2dyb3VuZDwvdGl0bGU+CiAgPHJlY3QgeD0iLTEiIHk9Ii0xIiB3aWR0aD0iNDIiIGhlaWdodD0iNDIiIGlkPSJjYW52YXNfYmFja2dyb3VuZCIgZmlsbD0ibm9uZSIvPgogIDxnIGlkPSJjYW52YXNHcmlkIiBkaXNwbGF5PSJub25lIj4KICAgPHJlY3QgaWQ9InN2Z18xIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4PSIwIiB5PSIwIiBzdHJva2Utd2lkdGg9IjAiIGZpbGw9InVybCgjZ3JpZHBhdHRlcm4pIi8+CiAgPC9nPgogPC9nPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxyZWN0IGZpbGw9IiMxODNjYTAiIHN0cm9rZS13aWR0aD0iMS41IiB4PSI3LjEyNTA4NCIgeT0iMjEuMjc3MzQ0IiB3aWR0aD0iNiIgaGVpZ2h0PSI0LjM3NDk2NiIgaWQ9InN2Z18yIiBzdHJva2U9IiMyMWM0YzQiLz4KICA8cmVjdCBmaWxsPSIjMTgzY2EwIiBzdHJva2Utd2lkdGg9IjEuNSIgeD0iMy42MjUxIiB5PSIyNS43NzczMTEiIHdpZHRoPSIxMi45OTk5MjIiIGhlaWdodD0iOS44NzQ5NDMiIGlkPSJzdmdfMyIgc3Ryb2tlPSIjMjFjNGM0Ii8+CiAgPHJlY3QgZmlsbD0iIzIxYzRjNCIgc3Ryb2tlPSIjMTgzY2EwIiBzdHJva2Utd2lkdGg9IjEuNSIgeD0iMjMuNzQ5OTc3IiB5PSI1LjI3NzQzNCIgd2lkdGg9IjEyLjQ5OTkyNSIgaGVpZ2h0PSI5Ljc0OTk0MSIgaWQ9InN2Z181Ii8+CiAgPHJlY3QgZmlsbD0iIzIxYzRjNCIgc3Ryb2tlLXdpZHRoPSIxLjUiIHg9IjI3LjI0OTk2IiB5PSIxNS4yNzczNzQiIHdpZHRoPSI2IiBoZWlnaHQ9IjQuMzc0OTY3IiBpZD0ic3ZnXzYiIHN0cm9rZT0iIzE4M2NhMCIvPgogIDxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZS13aWR0aD0iMS41IiB4MT0iMTUuNTAwMDI2IiB5MT0iMjEuNzc3MzM4IiB4Mj0iMjEuNzQ5OTk0IiB5Mj0iMTYuNzc3MzY1IiBpZD0ic3ZnXzciIHN0cm9rZS1saW5lam9pbj0ibnVsbCIgc3Ryb2tlLWxpbmVjYXA9Im51bGwiIHN0cm9rZT0iI2ZmMDAwMCIvPgogIDxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZS13aWR0aD0iMS41IiB4MT0iMjUuMTI0OTczIiB5MT0iMTguOTAyMzQ5IiB4Mj0iMTguODc1MDA4IiB5Mj0iMjQuMjc3MzIiIGlkPSJzdmdfOCIgc3Ryb2tlLWxpbmVqb2luPSJudWxsIiBzdHJva2UtbGluZWNhcD0ibnVsbCIgc3Ryb2tlPSIjMDA3ZjAwIi8+CiAgPGxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjEuNSIgeDE9IjE3LjI1MDAyMSIgeTE9IjE2LjQwMjM2OCIgeDI9IjIyLjI0OTk5MSIgeTI9IjE2LjY1MjM2NiIgaWQ9InN2Z185IiBzdHJva2UtbGluZWpvaW49Im51bGwiIHN0cm9rZS1saW5lY2FwPSJudWxsIi8+CiAgPGxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxLjUiIHgxPSIxOC4zNzUwMTIiIHkxPSIyNC40MDIzMTMiIHgyPSIyMi42MjQ5ODciIHkyPSIyNC40MDIzMTMiIGlkPSJzdmdfMTAiIHN0cm9rZS1saW5lam9pbj0ibnVsbCIgc3Ryb2tlLWxpbmVjYXA9Im51bGwiIHN0cm9rZT0iIzAwN2YwMCIvPgogIDx0ZXh0IGZpbGw9IiMyMWM0YzQiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIwIiB4PSI3LjA0MTY4MyIgeT0iMzQuMDE4MjE1IiBpZD0ic3ZnXzEyIiBmb250LXNpemU9IjkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiIGZvbnQtd2VpZ2h0PSJib2xkIj5CPC90ZXh0PgogIDx0ZXh0IGZpbGw9IiMyMDUzYzEiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIwIiB4PSIyNi4zMzMzMzQiIHk9IjEzLjgwOTg5OCIgaWQ9InN2Z18xNCIgZm9udC1zaXplPSIxMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWYiIHRleHQtYW5jaG9yPSJzdGFydCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgZm9udC13ZWlnaHQ9ImJvbGQiPkE8L3RleHQ+CiA8L2c+Cjwvc3ZnPg==';\n/**\n * Icon svg to be displayed at the left edge of each extension block, encoded as a data URI.\n * @type {string}\n */\n// eslint-disable-next-line max-len\nvar blockIconURI = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8IS0tIENyZWF0ZWQgd2l0aCBNZXRob2QgRHJhdyAtIGh0dHA6Ly9naXRodWIuY29tL2R1b3BpeGVsL01ldGhvZC1EcmF3LyAtLT4KCiA8Zz4KICA8dGl0bGU+YmFja2dyb3VuZDwvdGl0bGU+CiAgPHJlY3QgeD0iLTEiIHk9Ii0xIiB3aWR0aD0iNDIiIGhlaWdodD0iNDIiIGlkPSJjYW52YXNfYmFja2dyb3VuZCIgZmlsbD0ibm9uZSIvPgogIDxnIGlkPSJjYW52YXNHcmlkIiBkaXNwbGF5PSJub25lIj4KICAgPHJlY3QgaWQ9InN2Z18xIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4PSIwIiB5PSIwIiBzdHJva2Utd2lkdGg9IjAiIGZpbGw9InVybCgjZ3JpZHBhdHRlcm4pIi8+CiAgPC9nPgogPC9nPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxyZWN0IGZpbGw9IiMxODNjYTAiIHN0cm9rZS13aWR0aD0iMS41IiB4PSI3LjEyNTA4NCIgeT0iMjEuMjc3MzQ0IiB3aWR0aD0iNiIgaGVpZ2h0PSI0LjM3NDk2NiIgaWQ9InN2Z18yIiBzdHJva2U9IiMyMWM0YzQiLz4KICA8cmVjdCBmaWxsPSIjMTgzY2EwIiBzdHJva2Utd2lkdGg9IjEuNSIgeD0iMy42MjUxIiB5PSIyNS43NzczMTEiIHdpZHRoPSIxMi45OTk5MjIiIGhlaWdodD0iOS44NzQ5NDMiIGlkPSJzdmdfMyIgc3Ryb2tlPSIjMjFjNGM0Ii8+CiAgPHJlY3QgZmlsbD0iIzIxYzRjNCIgc3Ryb2tlPSIjMTgzY2EwIiBzdHJva2Utd2lkdGg9IjEuNSIgeD0iMjMuNzQ5OTc3IiB5PSI1LjI3NzQzNCIgd2lkdGg9IjEyLjQ5OTkyNSIgaGVpZ2h0PSI5Ljc0OTk0MSIgaWQ9InN2Z181Ii8+CiAgPHJlY3QgZmlsbD0iIzIxYzRjNCIgc3Ryb2tlLXdpZHRoPSIxLjUiIHg9IjI3LjI0OTk2IiB5PSIxNS4yNzczNzQiIHdpZHRoPSI2IiBoZWlnaHQ9IjQuMzc0OTY3IiBpZD0ic3ZnXzYiIHN0cm9rZT0iIzE4M2NhMCIvPgogIDxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZS13aWR0aD0iMS41IiB4MT0iMTUuNTAwMDI2IiB5MT0iMjEuNzc3MzM4IiB4Mj0iMjEuNzQ5OTk0IiB5Mj0iMTYuNzc3MzY1IiBpZD0ic3ZnXzciIHN0cm9rZS1saW5lam9pbj0ibnVsbCIgc3Ryb2tlLWxpbmVjYXA9Im51bGwiIHN0cm9rZT0iI2ZmMDAwMCIvPgogIDxsaW5lIGZpbGw9Im5vbmUiIHN0cm9rZS13aWR0aD0iMS41IiB4MT0iMjUuMTI0OTczIiB5MT0iMTguOTAyMzQ5IiB4Mj0iMTguODc1MDA4IiB5Mj0iMjQuMjc3MzIiIGlkPSJzdmdfOCIgc3Ryb2tlLWxpbmVqb2luPSJudWxsIiBzdHJva2UtbGluZWNhcD0ibnVsbCIgc3Ryb2tlPSIjMDA3ZjAwIi8+CiAgPGxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjEuNSIgeDE9IjE3LjI1MDAyMSIgeTE9IjE2LjQwMjM2OCIgeDI9IjIyLjI0OTk5MSIgeTI9IjE2LjY1MjM2NiIgaWQ9InN2Z185IiBzdHJva2UtbGluZWpvaW49Im51bGwiIHN0cm9rZS1saW5lY2FwPSJudWxsIi8+CiAgPGxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxLjUiIHgxPSIxOC4zNzUwMTIiIHkxPSIyNC40MDIzMTMiIHgyPSIyMi42MjQ5ODciIHkyPSIyNC40MDIzMTMiIGlkPSJzdmdfMTAiIHN0cm9rZS1saW5lam9pbj0ibnVsbCIgc3Ryb2tlLWxpbmVjYXA9Im51bGwiIHN0cm9rZT0iIzAwN2YwMCIvPgogIDx0ZXh0IGZpbGw9IiMyMWM0YzQiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIwIiB4PSI3LjA0MTY4MyIgeT0iMzQuMDE4MjE1IiBpZD0ic3ZnXzEyIiBmb250LXNpemU9IjkiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiIGZvbnQtd2VpZ2h0PSJib2xkIj5CPC90ZXh0PgogIDx0ZXh0IGZpbGw9IiMyMDUzYzEiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIwIiB4PSIyNi4zMzMzMzQiIHk9IjEzLjgwOTg5OCIgaWQ9InN2Z18xNCIgZm9udC1zaXplPSIxMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWYiIHRleHQtYW5jaG9yPSJzdGFydCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgZm9udC13ZWlnaHQ9ImJvbGQiPkE8L3RleHQ+CiA8L2c+Cjwvc3ZnPg==';\n\n/**\n * 超时设定\n * @type {int}\n */\nvar SERVER_TIMEOUT = 500; // 10 seconds\n/**\n * 接收到的数据\n * @type {STRING}\n */\nvar RAWDATA = '';\nvar nLastSendingTime = 0;\nvar SENDINGDELAY = 2000;\n\n/**\n * Class for the ChattingRoom blocks.\n * @constructor\n */\nvar Scratch3ChattingRoomBlocks = function () {\n  function Scratch3ChattingRoomBlocks(runtime) {\n    _classCallCheck(this, Scratch3ChattingRoomBlocks);\n    /**\n     * The runtime instantiating this block package.\n     * @type {Runtime}\n     */\n    this.runtime = runtime;\n    /**\n     * Map of soundPlayers by sound id.\n     * @type {Map<string, SoundPlayer>}\n     */\n    //this._soundPlayers = new Map();\n //   this._stopAllSpeech = this._stopAllSpeech.bind(this);\n //   if (this.runtime) {\n //     this.runtime.on('PROJECT_STOP_ALL', this._stopAllSpeech);\n //   }\n    this._onTargetCreated = this._onTargetCreated.bind(this);\n    if (this.runtime) {\n      runtime.on('targetWasCreated', this._onTargetCreated);\n    }\n  }\n  /**\n   * An object with info for each voice.\n   */\n  _createClass(Scratch3ChattingRoomBlocks, [{\n    key: \"_getState\",\n    /**\n     * @param {Target} target - collect  state for this target.\n     * @returns {ChattingRoomState} the mutable state associated with that target. This will be created if necessary.\n     * @private\n     */\n    value: function _getState(target) {\n      var state = target.getCustomState(Scratch3ChattingRoomBlocks.STATE_KEY);\n      if (!state) {\n        state = Clone.simple(Scratch3ChattingRoomBlocks.DEFAULT_CHATTINGROOM_STATE);\n        target.setCustomState(Scratch3ChattingRoomBlocks.STATE_KEY, state);\n      }\n      return state;\n    }\n    /**\n     * When a Target is cloned, clone the state.\n     * @param {Target} newTarget - the newly created target.\n     * @param {Target} [sourceTarget] - the target used as a source for the new clone, if any.\n     * @listens Runtime#event:targetWasCreated\n     * @private\n     */\n  }, {\n    key: \"_onTargetCreated\",\n    value: function _onTargetCreated(newTarget, sourceTarget) {\n      if (sourceTarget) {\n        var state = sourceTarget.getCustomState(Scratch3ChattingRoomBlocks.STATE_KEY);\n        if (state) {\n          newTarget.setCustomState(Scratch3ChattingRoomBlocks.STATE_KEY, Clone.simple(state));\n        }\n      }\n    }\n    /**\n     * @returns {object} metadata for this extension and its blocks.\n     */\n  }, {\n    key: \"getInfo\",\n    value: function getInfo() {\n      // Only localize the default input to the \"speak\" block if we are in a\n      // supported language.\n      var defaultTextToSpeak = 'hello';\n      return {\n        id: 'chattingroom',\n        name: formatMessage({\n          id: 'chattingroom.categoryName',\n          default: '互动工具',\n          description: 'Name of the Text to Speech extension.'\n        }),\n        blockIconURI: blockIconURI,\n        menuIconURI: menuIconURI,\n        blocks: [{\n          opcode: 'whenChatMessageComes',\n          text: formatMessage({\n            id: 'chattingroom.whenChatMessageComes',\n            default: '当收到聊天消息',\n            description: 'When Chat Message comes.'\n          }),\n          blockType: BlockType.HAT\n        }, {\n          opcode: 'sendMsgTo',\n          text: formatMessage({\n            id: 'chattingroom.sendMsgToBlock',\n            default: '向[USER]发送[MSG]',\n            description: 'Set the language for speech synthesis.'\n          }),\n          blockType: BlockType.COMMAND,\n          arguments: {\n            USER: {\n              type: ArgumentType.STRING,\n              menu: 'userlist',\n              defaultValue: '请选择好友'\n            },\n            MSG: {\n              type: ArgumentType.STRING,\n              defaultValue: '你好！'\n            }\n          }\n        }, {\n          opcode: 'lastMsgFrom',\n          text: formatMessage({\n            id: 'chattingroom.lastMsgFrom',\n            default: '来自[USER]的最后一条消息',\n            description: 'The last message from USER.'\n          }),\n          blockType: BlockType.REPORTER,\n          arguments: {\n            USER: {\n              type: ArgumentType.STRING,\n              menu: 'userlist',\n              defaultValue: '请选择好友'\n            }\n          }\n        }, {\n          opcode: 'lastReceivedMsg',\n          text: formatMessage({\n            id: 'chattingroom.lastReceivedMsgBlock',\n            default: '最后一条未读消息',\n            description: 'The last message received.'\n          }),\n          disableMonitor: true,             //去掉REPORTER默认的CheckBox//显示CheckBox的策略，还有一个相关设置：不带参数。\n          blockType: BlockType.REPORTER     //使用forcedEnableMonitor可以强制打开CheckBox。此开关项需要修改GUI模块450的“_convertBlockForScratchBlocks”定义。\n          \n        }, {\n          opcode: 'lastReceivedMsgSender',\n          text: formatMessage({\n            id: 'chattingroom.lastReceivedMsgSender',\n            default: '最后一条未读消息的发送者',\n            description: 'The last user who sent the message.'\n          }),\n          disableMonitor: true,             //去掉REPORTER默认的CheckBox//显示CheckBox的策略，还有一个相关设置：不带参数。\n          blockType: BlockType.REPORTER     //使用forcedEnableMonitor可以强制打开CheckBox。此开关项需要修改GUI模块450的“_convertBlockForScratchBlocks”定义。\n          \n        }, {\n          opcode: 'sendReport',\n          text: formatMessage({\n            id: 'chattingroom.sendReport',\n            default: '上报信息：步长[STEPS]左拐[LEFT]右拐[RIGHT]耗时[TIME]',\n            description: 'Report the arguments.'\n          }),\n          blockType: BlockType.COMMAND,\n          arguments: {\n            STEPS: {\n              type: ArgumentType.NUMBER,\n              defaultValue: '0'\n            },\n            LEFT: {\n              type: ArgumentType.ANGLE,\n              defaultValue: '0'\n            },\n            RIGHT: {\n              type: ArgumentType.ANGLE,\n              defaultValue: '0'\n            },\n            TIME: {\n              type: ArgumentType.NUMBER,\n              defaultValue: '0'\n            }\n          }\n        }, {\n          opcode: 'sendReport2',\n          text: formatMessage({\n            id: 'chattingroom.sendReport2',\n            default: '上报信息：[MSG]',\n            description: 'Report the arguments.'\n          }),\n          blockType: BlockType.COMMAND,\n          arguments: {\n            MSG: {\n              type: ArgumentType.STRING,\n              defaultValue: '待发送消息'\n            }\n          }\n        }, {\n          opcode: 'splitString',\n          text: formatMessage({\n            id: 'chattingroom.splitString',\n            default: '按[NEEDLE]拆分字符串[STRTEXT]到列表[LIST]',\n            description: 'Split the string with keyword'\n          }),\n          blockType: BlockType.COMMAND,\n          arguments: {\n            NEEDLE: {\n              type: ArgumentType.STRING,\n              defaultValue: ' '\n            },\n            STRTEXT: {\n              type: ArgumentType.STRING,\n              defaultValue: '待拆分字符串'\n            },\n            LIST: {\n              type: ArgumentType.STRING,\n              defaultValue: '变量名'\n            }\n          }\n        }, {\n          opcode: 'unreadMsgLength',\n          text: formatMessage({\n            id: 'chattingroom.unreadMsgLengthBlock',\n            default: '未读消息数量',\n            description: 'The length of unread message.'\n          }),\n          blockType: BlockType.REPORTER\n        }],\n        menus: {\n          userlist: {\n            acceptReporters: true,\n            items: this.loadUserList()\n          }\n        }\n      };\n    }\n    /**\n     * 当收到数据时，激发此积木\n     * 接收到的数据保存在RAWDATA中\n     */\n  }, {\n    key: \"whenChatMessageComes\",\n    value: function whenChatMessageComes() {//返回接收到的数据\n       var _this4 = this;\n       if(bChattingRoom_NEWMESSAGE)\n       {\n          var block=_this4.runtime.monitorBlocks._blocks[\"chattingroom_unreadMsgLength\"];\n          var monitor=MonitorRecord({\n             id:       block.id,\n             targetId: block.targetId,\n             spriteName: block.targetId ? this.runtime.getTargetById(block.targetId).getName() : null,\n             opcode:   block.opcode,\n             params:   {},\n             value:    (arrChattingRoom_MSGLIST.length==0)?'0':arrChattingRoom_MSGLIST.length,\n             mode:     block.opcode === 'data_listcontents' ? 'list' : 'default'\n          });\n          if (!_this4.runtime.requestShowMonitor(block.id)) {\n             _this4.runtime.requestAddMonitor(monitor);\n          }\n          if(monitor!=null) _this4.runtime.requestUpdateMonitor(monitor);\n\n          bChattingRoom_NEWMESSAGE=false;\n          return true;\n       }\n       else return false;\n    }\n  },{\n    key: \"loadUserList\",\n    value: function loadUserList() {//返回接收到的数据\n       var _this4 = this;\n       var userList = arrUserList;\n       if(userList.indexOf(\"所有人\")==-1)\n          userList.push(\"所有人\");\n       return userList;\n    }\n  },{\n    key: \"lastMsgFrom\",\n    value: function lastMsgFrom(args, util) {//返回接收到的数据\n      var user = Cast.toString(args.USER);\n      var bFound=false;\n      if(arrChattingRoom_MSGLIST.length>0)\n      {\n         if(user==\"所有人\") {\n            var msgText=arrChattingRoom_MSGLIST.pop();\n            return msgText[0]+\"对\"+msgText[1]+\"说：\"+msgText[2];\n         }\n         else\n         {\n            for(var mlen=0;mlen<arrChattingRoom_MSGLIST.length;mlen++)\n            {\n               if(arrChattingRoom_MSGLIST[mlen][0]==user)\n               {\n                  var msg=arrChattingRoom_MSGLIST[mlen][2];\n                  arrChattingRoom_MSGLIST.splice(mlen,1);\n                  return msg;\n                }\n             }\n         }\n      }\n      if(!bFound) return '';\n    }\n  },{\n    key: \"sendReport\",\n    value: function sendReport(args, util) {//返回接收到的数据\n       //var _this4 = this;\n       var currentTime=Date.now();\n       if(bREPORTING==true && currentTime-nLastSendingTime>SENDINGDELAY ){//间隔控制\n          nLastSendingTime=currentTime;\n          var steps = Cast.toString(args.STEPS);\n          var left  = Cast.toString(args.LEFT);\n          var right = Cast.toString(args.RIGHT);\n          var time  = Cast.toString(args.TIME);\n          var msg = {'content': 'RACING'+'_'+steps+'_'+left+'_'+right+'_'+time, 'type': 'user','to':strTeacher};//定向发送给老师\n          sendMsg(msg);\n       }\n       /*\n       var path = \"./extension/chatting/index.php\";\n       path += \"?S=\"+steps;\n       path += \"&L=\"+left;\n       path += \"&R=\"+right;\n       path += \"&T=\"+time;\n       return new Promise(function (resolve) {\n        nets({\n          url: path,\n          timeout: SERVER_TIMEOUT,\n          //json:true\n        }, function (err, res, body) {\n          if (err) {\n            log.warn(err);\n            return resolve();\n          }\n          if (res.statusCode !== 200) {\n            log.warn(res.statusCode);\n            return resolve();\n          } // Play the sound\n          //var sound = {\n          //  data: {\n          //    buffer: body.buffer\n          //  }\n          //};\n          return resolve();\n        });\n      });\n      */\n    }\n  },{\n    key: \"sendReport2\",\n    value: function sendReport2(args, util) {//返回接收到的数据\n       //var _this4 = this;\n       var currentTime=Date.now();\n       if(bREPORTING==true && currentTime-nLastSendingTime>SENDINGDELAY ){//间隔控制\n          nLastSendingTime=currentTime;\n          var message = Cast.toString(args.MSG);\n          var msg = {'content': 'RACING'+'_'+strCurrentFilename+'_'+message, 'type': 'user','to':strTeacher};//定向发送给老师\n          sendMsg(msg);\n       }\n    }\n  },{\n    key: \"findTargetByBlock\",               //通过opcode，确认该积木在哪个角色中。\n    value: function findTargetByBlock(opcode) //只返回第一个匹配项\n    {\n       var n=oVMM.props.vm.runtime.targets.length;\n       for(var i=0;i<n;i++)\n       {\n          var v=Object.values(oVMM.props.vm.runtime.targets[i].blocks._blocks);\n          if((typeof v.find(function(block) {return block.opcode===opcode;})) == 'object') return i;\n       }\n       return -1;\n    }\n  },{\n    key: \"sendMsgTo\",\n    value: function sendMsgTo(args, util) {//返回接收到的数据\n      var _this4 = this;\n      var userid = Cast.toString(args.USER);\n       var currentTime=Date.now();\n       if(bREPORTING==true && currentTime-nLastSendingTime>SENDINGDELAY ){//间隔控制\n          nLastSendingTime=currentTime;\n          if(userid!=\"请选择好友\"){\n             var msg = Cast.toString(args.MSG);\n             var msgTEXT = { 'content': msg, 'type': 'chat', 'to': userid };\n             sendMsg(msgTEXT);\n          }\n          else return \"发送前，请先选择一位好友。\";\n       }\n    }\n  },{\n    key: \"splitString\",\n    value: function splitString(args, util) {//返回接收到的数据\n      //var _this4 = this;\n      var needle = Cast.toString(args.NEEDLE);\n      var strText = Cast.toString(args.STRTEXT);\n      var strUID= Math.floor(Math.random() * 0x10000000000).toString(16);\n      var list=util.target.lookupOrCreateList(strUID, Cast.toString(args.LIST));\n      list.value=strText.split(needle).filter(char => char !== '');\n      return;\n    }\n  },{\n    key: \"lastReceivedMsg\",\n    value: function lastReceivedMsg(args, util) {//返回接收到的数据\n      var _this4 = this;\n      if(arrChattingRoom_MSGLIST.length>0)\n      {\n          var block=_this4.runtime.monitorBlocks._blocks[\"chattingroom_unreadMsgLength\"];\n          var monitor=MonitorRecord({\n             id:       block.id,\n             targetId: block.targetId,\n             spriteName: block.targetId ? this.runtime.getTargetById(block.targetId).getName() : null,\n             opcode:   block.opcode,\n             params:   {},\n             value:    (arrChattingRoom_MSGLIST.length==1)?'0':arrChattingRoom_MSGLIST.length-1,\n             mode:     block.opcode === 'data_listcontents' ? 'list' : 'default'\n          });\n          if (!_this4.runtime.requestShowMonitor(block.id)) {\n             _this4.runtime.requestAddMonitor(monitor);\n          }\n          if(monitor!=null) _this4.runtime.requestUpdateMonitor(monitor);\n\n         var msgText=arrChattingRoom_MSGLIST.pop();\n         return msgText[0]+\"对\"+msgText[1]+\"说：\"+msgText[2];\n      }\n      else return '';\n    }\n  },{\n    key: \"lastReceivedMsgSender\",\n    value: function lastReceivedMsgSender(args, util) {//返回接收到的数据\n      var _this4 = this;\n      //if(arrChattingRoom_MSGLIST.length>0)\n      //{\n      //   var block=_this4.runtime.monitorBlocks._blocks[\"chattingroom_unreadMsgLength\"];\n      //   var monitor=MonitorRecord({\n      //      id:       block.id,\n      //      targetId: block.targetId,\n      //      spriteName: block.targetId ? this.runtime.getTargetById(block.targetId).getName() : null,\n      //      opcode:   block.opcode,\n      //      params:   {},\n      //      value:    (arrChattingRoom_MSGLIST.length==1)?'0':arrChattingRoom_MSGLIST.length-1,\n      //      mode:     block.opcode === 'data_listcontents' ? 'list' : 'default'\n      //   });\n      //   if (!_this4.runtime.requestShowMonitor(block.id)) {\n      //      _this4.runtime.requestAddMonitor(monitor);\n      //   }\n      //   if(monitor!=null) _this4.runtime.requestUpdateMonitor(monitor);\n\n         var msgText=arrChattingRoom_MSGLIST.pop();//只获取发送者，不删除记录。\n         if(msgText!=null){\n            arrChattingRoom_MSGLIST.push(msgText);\n            return msgText[0];//+\"对\"+msgText[1]+\"说：\"+msgText[2];\n         }\n         else return '';\n      //}\n      //else return '';\n    }\n  },{\n    key: \"unreadMsgLength\",\n    value: function unreadMsgLength(args, util) {//返回接收到的数据\n      //var _this4 = this;\n      return arrChattingRoom_MSGLIST.length==0?'0':arrChattingRoom_MSGLIST.length;\n    }\n  }], [{\n    key: \"STATE_KEY\",\n    get: function get() {\n      return 'Scratch.chattingroom';\n    }\n    /**\n     * The default state, to be used when a target has no existing state.\n     * @type {ChattingRoomState}\n     */\n  }, {\n    key: \"DEFAULT_CHATTINGROOM_STATE\",\n    get: function get() {\n      return {\n        voiceId: ALTO_ID\n      };\n    }\n  }]);\n  return Scratch3ChattingRoomBlocks;\n}();\nmodule.exports = Scratch3ChattingRoomBlocks;\n })